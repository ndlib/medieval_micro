(function(a){a.selectList=function(n,d){var m,b,c,e,p,q,k,f=0,h,o,g,r;function t(v,w){if(d.addAnimate&&k){if(typeof d.addAnimate=="function"){d.addAnimate(v.hide()[0],w)}else{v.hide().fadeIn(300,w)}}else{v.show();if(w){w.call(v[0])}}}function i(v,w){if(d.removeAnimate&&k){if(typeof d.removeAnimate=="function"){d.removeAnimate(v[0],w)}else{v.fadeOut(300,w)}}else{v.hide();if(w){w.call(v[0])}}}function j(w,v){return typeof d.sort=="function"?d.sort(w,v):(a(w).data("text")>a(v).data("text"))==(d.sort!="desc")}function l(w,x,v){if(a(w).is("option")){p=a(w);
if(p[0].index<f){return}w=p.val();x=p.text()}else{p=m.find('option[value="'+w.replace("'",'\\"')+'"]');if(p.length){p=p.filter(function(){return !x||a(this).text()==x}).add(p).eq(0)}else{p=null}}if(x===undefined){x=p?p.text():w}if(p&&!d.duplicates){p.attr("disabled","disabled").data("disabled",1)}e=a(d.template.replace(/%text%/g,a("<b/>").text(x).html()).replace(/%value%/g,w)).hide();e.data("value",w).data("text",x).data("option",p).addClass(d.classPrefix+"-item");e.click(function(){if(d.clickRemove){u(a(this))
}});if(f&&!g){m[0].selectedIndex=0}var y=function(){if(v!==false){d.onAdd(n,w,x)}};if(d.sort&&(c=b.children().eq(0)).length){while(c.length&&j(e[0],c[0])){c=c.next()}t(c.length?e.insertBefore(c):e.appendTo(b),y)}else{t(e.appendTo(b),y)}a(n).empty();b.children().each(function(){a(n).append(a("<option/>").attr({value:a(this).data("value"),selected:"selected"}))});s()}function u(w,v){i(w,function(){var x=a(this).data("value"),y=a(this).data("text");if(a(this).data("option")){a(this).data("option").removeAttr("disabled").removeData("disabled")
}a(this).remove();a(n).find('option[value="'+x+'"]').remove();s();if(v!==false){d.onRemove(n,x,y)}})}function s(){if(n.form&&typeof(a(n.form).validate)=="function"&&a(n).add(m).hasClass(a(n.form).validate().settings.errorClass)){a(n.form).validate().element(n)}}this.val=function(){return a(n).val()};this.add=function(v,w){l(v,w)};this.remove=function(v){b.children().each(function(){if(a(this).data("value")==v){u(a(this))}})};this.setOptions=function(y){var x=y.sort&&y.sort!=d.sort;d=a.extend(d,y);if(x){var v=[];
b.children().each(function(){v[v.length]=a(this).data("value");v[v.length]=a(this).data("text")});b.empty();for(var w=0;w<v.length;w+=2){l(v[w],v[w+1],false)}}};this.setOptions(d=a.extend({addAnimate:true,classPrefix:"selectlist",clickRemove:true,removeAnimate:true,template:"<li>%text%</li>",onAdd:function(){},onRemove:function(){}},d));m=a(n).clone();m.removeAttr("id").removeAttr("name").addClass(d.classPrefix+"-select").insertAfter(a(n));a(n).empty().hide();(b=a(d.list||a("<ul/>").insertAfter(m))).addClass(d.classPrefix+"-list");
m.find(":selected").each(function(){l(a(this),null,false)});m.removeAttr("multiple");m.get(0).removeAttribute("size");if(m.attr("title")){m.prepend(a("<option/>").text(m.attr("title")));f=1;m[0].selectedIndex=0}q=a.browser.msie||a.browser.safari?"keydown":"keypress";m.bind(q,function(v){g=true;if((v.keyCode||v.which)==13){r=true;m.change();g=true;return false}}).change(function(){if(!g&&!o){return}h=true;p=m.find("option:selected");if(!p.data("disabled")&&(!g||r)){l(p)}if(g){g=h=o=false}r=false}).mousedown(function(){o=true
});m.find("option").click(function(v){if(a.browser.mozilla&&v.pageX>=m.offset().left&&v.pageX<=m.offset().left+m.outerWidth()&&v.pageY>=m.offset().top&&v.pageY<=m.offset().top+m.outerHeight()){return false}o=true;if(!(a(this).attr("disabled")||a(this).data("disabled")||g||h)){l(a(this))}if(!g){h=o=false}return false});k=true};a.fn.selectList=function(b){b=b||{};this.filter("select").each(function(){if(a(this).data("selectList")){a(this).data("selectList").setOptions(b)}else{a(this).data("selectList",new a.selectList(this,b))
}});if(b.instance){return this.filter("select").data("selectList")}return this}})(jQuery);